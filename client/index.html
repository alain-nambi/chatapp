<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>💬 Real-Time Chat</title>
  <style>
    body { font-family: sans-serif; margin: 2rem; }
    input, button { padding: 0.5rem; margin: 0.25rem; }
    #chat { border: 1px solid #ccc; padding: 1rem; max-height: 300px; overflow-y: auto; }
    .msg { margin-bottom: 0.5rem; }
  </style>
</head>
<body>
  <h2>⚡ Real-Time Chat with Socket.IO</h2>

  <div>
    <label>Your User ID: </label>
    <input id="userId" placeholder="e.g., user1">
    <button onclick="register()">Register</button>
  </div>

  <div>
    <label>Send to User ID: </label>
    <input id="toUserId" placeholder="e.g., user2">
  </div>

  <div>
    <input id="messageInput" placeholder="Type your message...">
    <button onclick="sendMessage()">Send</button>
  </div>

  <h3>🧾 Chat Log:</h3>
  <div id="chat"></div>

  <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
  <script>
    const socket = io('http://localhost:3456'); // ⚠️ Change port if needed

    let currentUser = null;

    function register() {
      const userId = document.getElementById('userId').value.trim();
      if (!userId) return alert('Please enter your user ID');
      socket.emit('register', userId);
      currentUser = userId;
      log(`✅ Registered as ${userId}`);
    }

    function sendMessage() {
      const to = document.getElementById('toUserId').value.trim();
      const text = document.getElementById('messageInput').value.trim();
      if (!to || !text || !currentUser) return alert('Fill all fields first');
      socket.emit('message', { from: currentUser, to, text });
      log(`📤 To ${to}: ${text}`);
      document.getElementById('messageInput').value = '';
    }

    socket.on('receive-message', (data) => {
      log(`📥 From ${data.from}: ${data.text}`);
    });

    function log(message) {
      const chat = document.getElementById('chat');
      const div = document.createElement('div');
      div.className = 'msg';
      div.textContent = message;
      chat.appendChild(div);
      chat.scrollTop = chat.scrollHeight;
    }
  </script>
</body>
</html>
